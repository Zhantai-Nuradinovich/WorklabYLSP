@page "/"
@inject IJSRuntime JsRuntime;

<div class="parallax">
    <div class="my-container">
        <div class="grid-container">
            <div class="grid-item">
                <div class="my-brand">
                    <h1 class="my-title">Worklab<br /></h1>
                    <h3 class="my-subtitle">Выбирая профессию, ты выбираешь своё будущее</h3>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="my-main my-main-raised">
    <div class="my-container">
        <div class="grid-container" style="justify-content: center">
            <div class="grid-item col-sm-12 col-sm-12 col-md-8">
                <h2 style="justify-content: center; text-align: center">Ты можешь стать</h2>
            </div>
        </div>
        <!--About carousels https://mdbootstrap.com/docs/jquery/javascript/carousel/ -->
        <div class="grid-container" style="justify-content: center">
            <div class="grid-item col-sm-12 col-sm-12 col-md-8">
                <div id="carouselExampleIndicators"
                     class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img class="d-block w-50" src="_content/BlazorBoilerplate.CommonUI/images/logo-work.png" alt="Pepa Pig">
                            <div class="carousel-caption">
                                <h3>Los Angeles</h3>
                                <p>We had such a great time in LA!</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-50" src="_content/BlazorBoilerplate.CommonUI/images/finance.jpg" alt="Sponge Bob">
                            <div class="carousel-caption">
                                <h3>Los Angeles</h3>
                                <p>We had such a great time in LA!</p>
                            </div>
                        </div>
                    </div>
                    <a id="carouselExampleIndicators-prev"
                       class="carousel-control-prev" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a id="carouselExampleIndicators-next"
                       class="carousel-control-next" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
        <div class="grid-container" style="justify-content: center; text-align: center">
            <div class="grid-item col-sm-12 col-sm-12 col-md-8">
                <h3 style="justify-content: center; text-align: center">Выбирай профессию и попробуй её прямо сейчас!!</h3>
                @if (!IsAuthenticated)
                {
                    <MatButton Icon="power_settings_new"
                               Raised="true"
                               Label="Начать"
                               Link="/account/login">
                    </MatButton>
                }
            </div>
        </div>
    </div>
</div>
<MatSnackbar @bind-IsOpen="@lazySnackbarIsOpen">
    <MatSnackbarContent>Если вам понравился продукт, поддержите нас в соцсетях</MatSnackbarContent>
    <MatSnackbarActions>
        <a href="https://www.instagram.com/ylsp_kg/" target="_blank" style="text-decoration: none">
            <MatButton>
                <i class="fa fa-instagram" style="color: white !important" aria-hidden="true"></i>
            </MatButton>
        </a>
        <a href="https://www.facebook.com/ylsp.2020/" target="_blank" style="text-decoration: none">
            <MatButton>
                <i class="fa fa-facebook" style="color: white !important" aria-hidden="true"></i>
            </MatButton>
        </a>
    </MatSnackbarActions>
</MatSnackbar>

@functions {
        int currentCount = 0;
        bool firstRender = true;

        protected async override Task OnAfterRenderAsync(bool firstRender)
        {
            if (firstRender)
            {
                await JsRuntime.InvokeAsync<object>("initializeCarousel");
                firstRender = false;
            }
        } 
    }

@code{ bool lazySnackbarIsOpen = false;
    private bool IsAuthenticated = false;

    [CascadingParameter]
    Task<AuthenticationState> authenticationStateTask { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        await Task.Delay(TimeSpan.FromSeconds(3)).ContinueWith((_) =>
        {
            this.lazySnackbarIsOpen = true;
        });

        var user = (await authenticationStateTask).User;
        if (user.Identity.IsAuthenticated)
        {
            IsAuthenticated = true;
        }
    }

    public void Dispose()
    {
    }
}